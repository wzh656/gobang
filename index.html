<!DOCTYPE html>
<!-- Copyright © 2021 by wzh -->
<html lang="zh">
	<head>
		<meta charset="UTF-8" />
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
		<title>五子棋</title>
		
		<!--icon-->
		<link href="./img/icon.png" rel="icon" type="image/x-icon"/>
		
		<!-- 异步fonts加载 -->
		<script src="./js/webfontloader.js"></script>
		<script>
		if (typeof require != "undefined"){ //electron
			console.log("electron")
			document.write(`<link href="./css/fonts.css" rel="stylesheet" type="text/css" />`);
			window.onload = function(){
				console.log("onload")
				$("body").addClass("wf-active");
			}
		}else{
			WebFont.load({
				google: {
					families: ["kt", "st", "xs", "zyyt"],
					api: "./css/fonts.css"
				}
			});
		}
		</script>
		
		<style>
		/* 字体缩放方案 */
		@media screen and (max-width:320px){
			body {font-size: calc(0.018 * 320px + 6px) !important;}
		}
		body{
			font-size: calc(1.8vw + 6px) !important;
		}
		@media screen and (min-width: 960px){
			body {font-size: calc(0.018 * 960px + 6px) !important;}
		}
		
		/* element */
		*{
			outline: none; /* 无点击线 */
		}
		html{
			/* 禁止选择 */
			-moz-user-select: none;
			-khtml-user-select: none;
			user-select: none;
			
			/* 背景 */
			min-height: 100%;
			background: #1b2036 url("./img/background.jpg") no-repeat fixed center;
			background-size: cover;
			max-width: 100%;
			margin: auto;
		}
		
		/* 初始页 */
		body{
			position: absolute;
			width: 100%;
			height: 100%;
			left: 0;
			top: 0;
			margin: 0;
			padding: 0;
			
			display: flex;
			flex-direction: column;
			justify-content: space-around;
			
			/* 背景 */
			min-height: 100%;
			background: #1b2036 url("./img/background.jpg") no-repeat fixed center;
			background-size: cover;
			max-width: 100%;
			margin: auto;
		}
		/* h1 */
		body > h1{
			margin: 0;
			font-size: 3.6em;
			text-align: center;
			font-weight: bold;
			color: white;
		}
		
		/* set */
		#set{
			position: absolute;
			right: 0;
			top: 0;
			display: flex;
			flex-direction: column;
		}
		#set > i{
			display: block;
			font-size: 3.6em;
		}
		#set > label{
			display: block;
			margin: 0 auto;
			margin-top: -5px;
			font-size: 1.1em;
			font-weight: bold;
		}
		
		/* button */
		body > button{
			width: 66vw;
			margin: 0 auto;
			padding: 0.5rem;
			font-size: 2em;
			
			color: #6af;
			background-color: #fff;
			border: 3px outset #6af;
			border-radius: 0.3rem;
			transition: color 0.3s, background-color 0.3s;
		}
		body > button:hover{
			color: #fff;
			background-color: #6af;
		}
		body > button:active{
			background-color: #59e;
			border: 3px inset #6af;
		}
		
		
		/* 设置 */
		#settings{
			position: absolute;
			width: 100%;
			height: 100%;
			left: 0;
			top: 0;
			margin: 0;
			padding: 0;
			
			background-color: #fafafa;
			font-size: 1.5em;
		}
		
		/* h2 */
		#settings > h2{
			margin: 0.6rem;
			font-size: 1.6em;
			font-weight: bold;
			text-align: center;
		}
		
		/* flex填满 */
		#settings > form > div{
			margin: 1rem;
			display: flex;
		}
		#settings > form > div > *{
			margin: 0.2rem;
		}
		#settings > form > div > input[type="range"]{
			width: 25vw;
		}
		#settings > form > div > label,
		#settings > form > div > input[type="range"]{
			flex: none;
		}
		#settings > form > div > input[type="number"],
		#settings > form > div > button{
			width: 100%;
		}
		
		/* button */
		#settings > form > div > button{
			padding: 0.2rem;
			font-size: 1.2em;
			
			transition: color 0.3s, background-color 0.3s;
		}
		#settings > form > div > button.ok{
			color: #fff;
			background-color: #6af;
			border: 3px outset #6af;
			border-radius: 0.3rem;
		}
		/*#settings > form > div > button.ok:hover{
			color: #fff;
			background-color: #6af;
		}*/
		#settings > form > div > button.ok:active{
			background-color: #59e;
			border: 3px inset #6af;
		}
		
		#settings > form > div > button.cancel{
			color: #ea6;
			background-color: #fff;
			border: 3px outset #ea6;
			border-radius: 0.3rem;
		}
		#settings > form > div > button.cancel:hover{
			color: #fff;
			background-color: #ea6;
		}
		#settings > form > div > button.cancel:active{
			background-color: #d95;
			border: 3px inset #ea6;
		}
		</style>
		
		<!-- jquery -->
		<script src="./js/jquery.min.js"></script>
		<script>
		if (typeof require != "undefined") //electron
			window.$ = window.jQuery = require("./js/jquery.min.js");
		</script>
		
		<!-- layui -->
		<!--<link rel="stylesheet" href="https://unpkg.com/layui@2.6.4/dist/css/layui.css">
		<script src="https://unpkg.com/layui@2.6.8/dist/layui.js"></script>-->
		<script src="./layui/layui.js"></script>
		<link rel="stylesheet" href="./layui/css/layui.css">
		
		<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
		<script src="https://cdn.bootcss.com/vConsole/3.3.4/vconsole.min.js"></script>
		<script>
		if ( /ipad|iphone|midp|rv:1.2.3.4|ucweb|android|windows ce|windows mobile/.test( navigator.userAgent.toLowerCase() ) ){
			//手机
			eruda.init();
			new VConsole();
		}
		</script>
		
		<script src="./js/js_plus.min.js"></script> <!-- js+ -->
		
	</head>
	<body>
		<h1>五子棋</h1>
		<div id="set">
			<i class="layui-icon layui-icon-set-fill"></i>
			<label>设置</label>
		</div>
		<button id="two">双人对战</button>
		<button id="one">人机对战</button>
		<button id="online">多人联机</button>
		<section id="settings" style="display: none;">
			<h2>设置</h2>
			<form>
				<div>
					<label>连子数：</label>
					3<input type="range" min="3" max="10" value="5" class="n" />10
					<input type="number" min="3" max="10" value="5" />
				</div>
				<div>
					<label>棋盘大小(格)：</label>
					3<input type="range" min="3" max="20" value="19" class="size" />20
					<input type="number" min="3" max="20" value="19" />
				</div>
				<div>
					<label>棋子大小(px)：</label>
					10<input type="range" min="10" max="100" value="30" class="picSize" />100
					<input type="number" min="10" max="100" value="30" />
				</div>
				<div>
					<label>下棋位置：</label>
					<input type="radio" name="place" checked />格点
					<input type="radio" name="place" class="place" />格内
				</div>
				<div>
					<label>防误触摸式：</label>
					<input type="radio" name="mistake" class="mistake" />开启
					<input type="radio" name="mistake" />关闭
				</div>
				<div>
					<button class="cancel">取消</button>
					<button class="ok">确定</button>
				</div>
			</form>
		</section>
		
<script>
let device;
if ( /ipad|iphone|midp|rv:1.2.3.4|ucweb|android|windows ce|windows mobile/.test( navigator.userAgent.toLowerCase() ) ){
	device = 1; //手机
}else{
	device = 0; //电脑
}
</script>
<script>
$("#settings > form input.n").val( localStorage.getItem("五子棋_N") || 5 )
	.next().val( localStorage.getItem("五子棋_N") || 5 );
$("#settings > form input.size").val( localStorage.getItem("五子棋_size") || 19 )
	.next().val( localStorage.getItem("五子棋_size") || 19 );
$("#settings > form input.picSize").val( localStorage.getItem("五子棋_picSize") || 30 )
	.next().val( localStorage.getItem("五子棋_picSize") || 30 );
if (+localStorage.getItem("五子棋_place") == 1)
	$("#settings > form input.place").click();
if (localStorage.getItem("五子棋_mistake")){
	if (+localStorage.getItem("五子棋_mistake") == 0){
		$("#settings > form input.mistake").next().click();
	}else{
		$("#settings > form input.mistake").click();
	}
}else{
	if (device){ //手机
		$("#settings > form input.mistake").click();
		localStorage.setItem("五子棋_mistake", 1);
	}else{ //电脑
		$("#settings > form input.mistake").next().click();
		localStorage.setItem("五子棋_mistake", 0);
	}
}

//输入改变
$("#settings > form input[type='range']").change(function(){
	$(this).next().val( this.value );
});
$("#settings > form input[type='number']").change(function(){
	$(this).prev().val( +this.value );
	this.value = $(this).prev().val();
});



$("body").hide().fadeIn(1000);
function go(url){
	$("html").css("background", "#fffae8");
	$("body").animate({
		top: "-100%"
	}, 600, function(){
		location.href = url;
	});
	layer.load(0);
}

//双人对战
$("#two").click(function(){
	go("two.html");
});

//人机对战
$("#one").click(function(){
	go("one.html");
});

//多人联机
$("#online").click(function(){
	go("rooms.html");
});


//打开设置
$("#set").click(function(){
	$("#settings").slideDown("slow");
});

//禁止提交
$("#settings > form").submit(function(e){
	e.stopPropagation();
	e.cancelBubble = true;
	return false;
});

//取消
$("#settings button.cancel").click(function(){
	$("#settings").slideUp("slow");
});

//确定
$("#settings button.ok").click(function(){
	localStorage.setItem("五子棋_N", $("#settings > form input.n").val());
	localStorage.setItem("五子棋_size", $("#settings > form input.size").val());
	localStorage.setItem("五子棋_picSize", $("#settings > form input.picSize").val());
	localStorage.setItem("五子棋_place", +$("#settings > form input.place")[0].checked);
	localStorage.setItem("五子棋_mistake", +$("#settings > form input.mistake")[0].checked);
	layer.msg("设置成功");
	$("#settings").slideUp("slow");
});
</script>
		
	</body>
</html>
